# Railway configuration for Chatwoot
# https://docs.railway.app/reference/config-as-code

[build]
# Force using Dockerfile (not Nixpacks)
builder = "DOCKERFILE"
dockerfilePath = "docker/Dockerfile"

[build.args]
RAILS_ENV = "production"
NODE_ENV = "production"
NODE_OPTIONS = "--max-old-space-size=4096"
RAILS_SERVE_STATIC_FILES = "true"

[deploy]
# Number of instances to deploy
numReplicas = 1
# Start command for web service
startCommand = "bundle exec rails db:chatwoot_prepare && bundle exec rails server -b 0.0.0.0 -p ${PORT:-3000}"
# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
